<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - God's Masterpiece Registrations</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Cinzel:wght@400;600&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  /* Base Styles */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  :root {
    --primary-dark: #1a365d;
    --primary: #2c5282;
    --primary-light: #4299e1;
    --accent-gold: #d4af37;
    --accent-cream: #f8f4e6;
    --text-dark: #2d3748;
    --text-light: #f7fafc;
    --border-light: #e2e8f0;
  }
  
  body {
    background: linear-gradient(to bottom, #f8f9fb, #e6e9f0);
    color: var(--text-dark);
    font-family: 'Montserrat', sans-serif;
    line-height: 1.6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  /* Header Styles */
  header {
    background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
    color: var(--text-light);
    padding: 1.5rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    border-bottom: 3px solid var(--accent-gold);
  }
  
  .header-title {
    display: flex;
    flex-direction: column;
  }
  
  header h1 {
    font-family: 'Cinzel', serif;
    font-size: 2rem;
    font-weight: 600;
    letter-spacing: 1px;
    margin-bottom: 0.2rem;
  }
  
  .subtitle {
    font-size: 0.9rem;
    opacity: 0.9;
    font-weight: 300;
    letter-spacing: 0.5px;
  }
  
  #logoutBtn {
    background-color: transparent;
    border: 1px solid var(--accent-gold);
    color: var(--accent-gold);
    padding: 0.7rem 1.5rem;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
    font-family: 'Montserrat', sans-serif;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  #logoutBtn:hover {
    background-color: rgba(212, 175, 55, 0.1);
  }
  
  /* Main Layout */
  .admin-container {
    display: flex;
    flex: 1;
    overflow: hidden;
  }
  
  /* User List Section */
  .user-list-section {
    width: 35%;
    min-width: 380px;
    border-right: 1px solid var(--border-light);
    background: white;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
  }
  
  .section-header {
    padding: 1.5rem;
    background: var(--primary-dark);
    color: white;
    font-weight: 500;
    font-size: 1.2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: 'Playfair Display', serif;
  }
  
  .user-count {
    background: var(--accent-gold);
    color: var(--primary-dark);
    padding: 0.2rem 0.7rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
  }
  
  .search-box {
    padding: 1rem 1.5rem;
    background: var(--accent-cream);
    border-bottom: 1px solid var(--border-light);
  }
  
  .search-box input {
    width: 100%;
    padding: 0.8rem 1.2rem;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    font-size: 0.95rem;
    background: white;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='20' height='20'%3E%3Cpath fill='%232c5282' d='M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 3rem;
  }
  
  .user-list {
    overflow-y: auto;
    flex: 1;
  }
  
  .user-item {
    padding: 1.2rem 1.5rem;
    border-bottom: 1px solid var(--border-light);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .user-item:hover {
    background: #f8f9ff;
  }
  
  .user-item.active {
    background: #f0f4ff;
    border-left: 4px solid var(--primary);
  }
  
  .user-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 1.2rem;
  }
  
  .user-info {
    flex: 1;
  }
  
  .user-name {
    font-weight: 600;
    color: var(--primary-dark);
    margin-bottom: 0.3rem;
    font-family: 'Playfair Display', serif;
  }
  
  .user-contact {
    font-size: 0.85rem;
    color: #64748b;
    display: flex;
    gap: 1rem;
  }
  
  .user-contact span {
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }
  
  /* User Details Section */
  .user-details-section {
    flex: 1;
    overflow-y: auto;
    background: white;
    display: flex;
    flex-direction: column;
  }
  
  .user-details-header {
    padding: 1.5rem 2rem;
    background: var(--accent-cream);
    border-bottom: 1px solid var(--border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .selected-user-info h2 {
    font-family: 'Playfair Display', serif;
    color: var(--primary-dark);
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
  }
  
  .selected-user-contact {
    display: flex;
    gap: 1.5rem;
    color: var(--primary);
    font-size: 0.9rem;
  }
  
  .user-actions {
    display: flex;
    gap: 0.8rem;
  }
  
  .user-actions button {
    padding: 0.7rem 1.2rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    font-family: 'Montserrat', sans-serif;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
  }

  
  .delete-btn {
    background: #e53e3e;
    color: white;
  }
  
  .delete-btn:hover {
    background: #c53030;
  }
  
  .user-details-content {
    padding: 2rem;
    flex: 1;
    overflow-y: auto;
  }
  
  .detail-group {
    margin-bottom: 2.5rem;
  }
  
  .detail-group h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1.4rem;
    color: var(--primary-dark);
    margin-bottom: 1.2rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--accent-gold);
    display: inline-block;
  }
  
  .details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.2rem;
  }
  
  .detail-item {
    background: #f8f9ff;
    padding: 1rem;
    border-radius: 6px;
    border-left: 3px solid var(--primary-light);
  }
  
  .detail-label {
    font-weight: 600;
    color: var(--primary);
    display: block;
    margin-bottom: 0.4rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .detail-value {
    color: var(--text-dark);
    word-break: break-word;
    line-height: 1.5;
  }
  
  /* No selection state */
  .no-selection {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #a0aec0;
    text-align: center;
    padding: 3rem;
  }
  
  .no-selection i {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    color: var(--primary-light);
  }
  
  .no-selection h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    margin-bottom: 1rem;
    color: var(--primary);
  }
  
  .no-selection p {
    font-size: 1.1rem;
    max-width: 400px;
    line-height: 1.6;
  }
  
  /* Responsive Design */
  @media (max-width: 900px) {
    .admin-container {
      flex-direction: column;
    }
    
    .user-list-section {
      width: 100%;
      min-width: unset;
      border-right: none;
      border-bottom: 1px solid var(--border-light);
      max-height: 40vh;
    }
    
    .user-details-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .user-actions {
      align-self: flex-end;
    }
  }
  
  @media (max-width: 600px) {
    header {
      padding: 1.2rem;
      flex-direction: column;
      text-align: center;
      gap: 1rem;
    }
    
    .details-grid {
      grid-template-columns: 1fr;
    }
    
    .user-contact {
      flex-direction: column;
      gap: 0.3rem;
    }
    
    .selected-user-contact {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .user-actions {
      flex-direction: column;
      width: 100%;
    }
    
    .user-actions button {
      width: 100%;
      justify-content: center;
    }
  }
  
  /* Scrollbar Styling */
  ::-webkit-scrollbar {
    width: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--primary-light);
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: var(--primary);
  }
</style>
</head>
<body>

<header>
  <div class="header-title">
    <h1>God's Masterpiece</h1>
    <div class="subtitle">Administrative Portal - Member Registry</div>
  </div>
  <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
</header>

<div class="admin-container">
  <!-- User List Section -->
  <section class="user-list-section">
    <div class="section-header">
      <span>Registered Members</span>
      <span class="user-count" id="userCount">0</span>
    </div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search members...">
    </div>
    <div class="user-list" id="userList">
      <!-- Users will be injected here -->
    </div>
  </section>

  <!-- User Details Section -->
  <section class="user-details-section">
    <div class="user-details-header">
      <div class="selected-user-info">
        <h2 id="selectedUserName">Member Details</h2>
        <div class="selected-user-contact">
          <span id="selectedUserPhone"></span>
          <span id="selectedUserEmail"></span>
        </div>
      </div>
      <div class="user-actions">
        <button class="delete-btn" id="deleteUserBtn"><i class="fas fa-trash-alt"></i> Delete</button>
      </div>
    </div>
    <div class="user-details-content" id="userDetails">
      <div class="no-selection">
        <i class="fas fa-users"></i>
        <h3>Member Directory</h3>
        <p>Select a member from the list to view their complete registration details</p>
      </div>
    </div>
  </section>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDp-QHprDLLeAAgv04ZxTAGw-jJw5jbfDY",
    authDomain: "god-s-masterpiece.firebaseapp.com",
    projectId: "god-s-masterpiece",
    storageBucket: "god-s-masterpiece.firebasestorage.app",
    messagingSenderId: "532649511335",
    appId: "1:532649511335:web:812d6d7b51148b61d7ce82",
    measurementId: "G-K5BVF91PNP"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const adminUID = "SOaS8VYRkFXLtKxtFhC4id6NSoA2"; // your admin UID

  const userList = document.getElementById('userList');
  const userDetails = document.getElementById('userDetails');
  const selectedUserName = document.getElementById('selectedUserName');
  const selectedUserPhone = document.getElementById('selectedUserPhone');
  const selectedUserEmail = document.getElementById('selectedUserEmail');
  const userCount = document.getElementById('userCount');
  const logoutBtn = document.getElementById('logoutBtn');
  const deleteUserBtn = document.getElementById('deleteUserBtn');
  const searchInput = document.getElementById('searchInput');

  let usersData = [];
  let selectedUser = null;

  // Security: only allow admin UID to view
  onAuthStateChanged(auth, user => {
    if (!user || user.uid !== adminUID) {
      alert('You are not authorized to view this page.');
      window.location.href = 'index.html';
      return;
    }
    loadUsers();
  });

  // Logout
  logoutBtn.addEventListener('click', () => {
    signOut(auth).then(() => location.href = 'index.html');
  });

  // Search functionality
  searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    filterUsers(searchTerm);
  });

  function filterUsers(searchTerm) {
    const filteredUsers = usersData.filter(user => {
      const name = `${user.firstName || ''} ${user.lastName || ''}`.toLowerCase();
      const email = (user.email || '').toLowerCase();
      const phone = user.phone || '';
      
      return name.includes(searchTerm) || 
             email.includes(searchTerm) || 
             phone.includes(searchTerm);
    });
    
    renderUserList(filteredUsers);
  }

  async function loadUsers() {
    const snapshot = await getDocs(collection(db, 'registrations'));
    usersData = [];
    
    snapshot.forEach(docSnap => {
      usersData.push({
        id: docSnap.id,
        ...docSnap.data()
      });
    });
    
    userCount.textContent = usersData.length;
    renderUserList(usersData);
  }

  function renderUserList(users) {
    userList.innerHTML = '';
    
    if (users.length === 0) {
      userList.innerHTML = '<div class="no-selection"><i class="fas fa-user-times"></i><h3>No members found</h3></div>';
      return;
    }
    
    users.forEach(user => {
      const userItem = document.createElement('div');
      userItem.className = 'user-item';
      if (selectedUser && selectedUser.id === user.id) {
        userItem.classList.add('active');
      }
      
      const initials = `${user.firstName ? user.firstName[0] : ''}${user.lastName ? user.lastName[0] : ''}`;
      
      userItem.innerHTML = `
        <div class="user-avatar">${initials}</div>
        <div class="user-info">
          <div class="user-name">${user.firstName || ''} ${user.lastName || ''}</div>
          <div class="user-contact">
            <span><i class="fas fa-phone"></i> ${user.phone || 'No phone'}</span>
            <span><i class="fas fa-envelope"></i> ${user.email || 'No email'}</span>
          </div>
        </div>
      `;
      
      userItem.addEventListener('click', () => {
        selectUser(user);
      });
      
      userList.appendChild(userItem);
    });
  }

  function selectUser(user) {
    selectedUser = user;
    
    // Update active class in list
    document.querySelectorAll('.user-item').forEach(item => {
      item.classList.remove('active');
    });
    
    event.currentTarget.classList.add('active');
    
    // Update user details section
    selectedUserName.textContent = `${user.firstName || ''} ${user.lastName || ''}`;
    selectedUserPhone.innerHTML = `<i class="fas fa-phone"></i> ${user.phone || 'Not provided'}`;
    selectedUserEmail.innerHTML = `<i class="fas fa-envelope"></i> ${user.email || 'Not provided'}`;
    
    renderUserDetails(user);
  }

  function renderUserDetails(user) {
    // Group fields by category for better organization
    const categories = {
      "Personal Information": ["firstName", "lastName", "dob", "phone", "email", "maritalStatus", "state", "nationality"],
      "Family Details": ["parentName", "parentPhone"],
      "Professional Information": ["occupation"],
      "Acting Experience": ["canAct", "actingExperience", "previousDrama", "bestRole", "otherTalents"],
      "Spiritual Journey": ["bornAgain", "bornAgainDate", "believeTongues", "baptizedHolyGhost", "otherGifts", "giftsDetails"],
      "Ministry Involvement": ["joinReasons", "invitedBy", "otherMinistry", "ministryDetails", "helpNeeded", "committed"],
      "Personal Development": ["weaknesses", "addiction", "addictionDetails", "temperament", "mentor", "signature"]
    };
    
    let detailsHTML = '';
    
    for (const [category, fields] of Object.entries(categories)) {
      let categoryHTML = '';
      let hasData = false;
      
      fields.forEach(key => {
        if (user.hasOwnProperty(key) && user[key] !== undefined && user[key] !== '') {
          hasData = true;
          let value = user[key];
          if (value && value.seconds) { 
            value = new Date(value.seconds * 1000).toLocaleDateString(); 
          }
          if (Array.isArray(value)) value = value.join(', ');
          
          const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
          categoryHTML += `
            <div class="detail-item">
              <span class="detail-label">${label}</span>
              <span class="detail-value">${value || 'Not provided'}</span>
            </div>`;
        }
      });
      
      if (hasData) {
        detailsHTML += `
          <div class="detail-group">
            <h3>${category}</h3>
            <div class="details-grid">
              ${categoryHTML}
            </div>
          </div>`;
      }
    }
    
    userDetails.innerHTML = detailsHTML;
    
  

    
    deleteUserBtn.onclick = async () => {
      if(confirm('Are you sure you want to delete this member record?')){
        await deleteDoc(doc(db, 'registrations', selectedUser.id));
        loadUsers();
        userDetails.innerHTML = '<div class="no-selection"><i class="fas fa-users"></i><h3>Member Directory</h3><p>Select a member from the list to view their complete registration details</p></div>';
        selectedUserName.textContent = 'Member Details';
        selectedUserPhone.innerHTML = '';
        selectedUserEmail.innerHTML = '';
        selectedUser = null;
      }
    };
  }
</script>

</body>
</html>